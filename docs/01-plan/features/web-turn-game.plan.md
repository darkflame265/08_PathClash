# Plan: Web Turn-Based Game (PathClash)

> **Feature**: web-turn-game
> **Created**: 2026-02-28
> **Phase**: Plan
> **Level**: Dynamic

---

## 1. 개요 (Overview)

**PathClash**는 5×5 그리드 위에서 두 플레이어가 동시에 경로를 지정하고, 지정된 경로를 따라 말이 움직이는 웹 기반 실시간 턴제 게임이다.
공격자/도망자 역할 교대 시스템과 경로 충돌 판정을 핵심 메커니즘으로 한다.

### 핵심 가치

- **동시 계획**: 두 플레이어가 서로의 경로를 모른 채 동시에 10초 안에 경로 지정
- **역할 교대**: 매 라운드 공격자↔도망자 역할 전환으로 긴장감 유지
- **직관적 조작**: 드래그 + 방향키 지원으로 접근성 확보

---

## 2. 기능 요구사항 (Feature Requirements)

### 2.1 로비 (Lobby)

| ID   | 기능                          | 우선순위 |
| ---- | ----------------------------- | -------- |
| L-01 | 게스트 로그인 (닉네임만 입력) | P0       |
| L-02 | AI 대전 (싱글플레이)          | P1       |
| L-03 | 친구 대전 (6자리 코드 매칭)   | P0       |
| L-04 | 랜덤 매치메이킹               | P1       |

### 2.2 게임 코어 (Core Gameplay)

| ID   | 기능                                             | 우선순위 |
| ---- | ------------------------------------------------ | -------- |
| G-01 | 5×5 그리드 맵 렌더링                             | P0       |
| G-02 | 플레이어 말 초기 배치 (빨강: (0,2), 파랑: (4,2)) | P0       |
| G-03 | 10초 경로 지정 타이머 (게이지 표시)              | P0       |
| G-04 | 동시 경로 지정 → 동시 이동 실행                  | P0       |
| G-05 | 경로 포인트: 턴 수와 동일, 초기 5, 최대 10       | P0       |
| G-06 | 상하좌우 이동만 허용 (대각선 불가)               | P0       |
| G-07 | 경로 따라 애니메이션 이동 (일정 속도)            | P0       |
| G-08 | 경로 끝 도달 시 다음 라운드 시작                 | P0       |

### 2.3 공격/도망 시스템

| ID   | 기능                              | 우선순위 |
| ---- | --------------------------------- | -------- |
| C-01 | 시작 HP: 각 3                     | P0       |
| C-02 | 매 라운드 공격자/도망자 역할 교대 | P0       |
| C-03 | 충돌 시 도망자 HP -1              | P0       |
| C-04 | HP 0 → 패배 판정                  | P0       |

### 2.4 경로 지정 UI

| ID   | 기능                                                  | 우선순위 |
| ---- | ----------------------------------------------------- | -------- |
| P-01 | 자신의 말 클릭 후 드래그로 경로 지정                  | P0       |
| P-02 | 경로 끝 칸 클릭 후 이전 칸으로 드래그 → 되돌리기      | P0       |
| P-03 | 되돌리는 중 새 칸 드래그 → 새 경로 추가               | P0       |
| P-04 | 방향키로 경로 작성                                    | P0       |
| P-05 | 빨강 경로선: 파랑보다 두껍게, 파랑 경로선이 위에 렌더 | P0       |

### 2.5 시각/사운드 이펙트

| ID   | 기능                                     | 우선순위 |
| ---- | ---------------------------------------- | -------- |
| V-01 | 공격자 말에 광원 이펙트 (말에 붙어 이동) | P0       |
| V-02 | 충돌 시 도망자 말 깜빡임 (피격 표시)     | P0       |
| V-03 | 충돌 칸 충돌 이펙트 애니메이션           | P0       |
| V-04 | HP 0 된 말 폭발 후 사라짐                | P0       |
| V-05 | 피격된 하트 HP UI 덜덜 떨림              | P0       |
| V-06 | 피격 사운드 효과음                       | P1       |
| V-07 | 음소거 버튼                              | P1       |

### 2.6 HP UI

| ID   | 기능                                                | 우선순위 |
| ---- | --------------------------------------------------- | -------- |
| H-01 | 자신 색상의 HP 텍스트만 Bold 표시 (플레이어별 다름) | P0       |
| H-02 | 하트 모양 HP 표시                                   | P0       |

### 2.7 게임 종료/재시합

| ID   | 기능                                           | 우선순위 |
| ---- | ---------------------------------------------- | -------- |
| E-01 | 승자: YOU WIN / 패자: YOU LOSE 표시            | P0       |
| E-02 | REMATCH 버튼 표시                              | P0       |
| E-03 | 재시합 요청 시 상대방 화면에 알림 표시         | P0       |
| E-04 | 양쪽 모두 REMATCH 수락 시 게임 재시작          | P0       |
| E-05 | 동시 REMATCH 클릭 시에도 정상 처리 (중복 방지) | P0       |

### 2.8 채팅

| ID    | 기능                             | 우선순위 |
| ----- | -------------------------------- | -------- |
| CH-01 | Tab 키로 채팅 입력창 포커스 토글 | P1       |
| CH-02 | 키보드만으로 게임 진행 가능      | P1       |

### 2.9 인게임 UI/UX

| ID   | 기능                                                          | 우선순위 |
| ---- | ------------------------------------------------------------- | -------- |
| U-01 | 타이머 게이지 (줄어드는 애니메이션)                           | P0       |
| U-02 | 상대 닉네임 클릭 시 프로필 박스 토글 (닉네임, 전적, 승률, ID) | P1       |

---

## 3. 기술 스택 (Tech Stack)

| 레이어      | 기술                                      | 근거                                 |
| ----------- | ----------------------------------------- | ------------------------------------ |
| Frontend    | **React + TypeScript**                    | 컴포넌트 기반 상태 관리, 타입 안전성 |
| 스타일      | **CSS Modules / Tailwind CSS**            | 빠른 개발, 스코프 격리               |
| 애니메이션  | **CSS Animation + requestAnimationFrame** | 경로 이동 애니메이션, 이펙트         |
| 실시간 통신 | **Socket.IO (WebSocket)**                 | 동시 경로 제출, 이동 동기화          |
| 서버        | **Node.js + Express**                     | Socket.IO 서버, 게임 로직            |
| 상태 관리   | **Zustand**                               | 게임 상태 (경로, HP, 역할, 타이머)   |
| 오디오      | **Web Audio API / Howler.js**             | 효과음 재생, 음소거                  |
| 빌드        | **Vite**                                  | 빠른 개발 서버                       |

---

## 4. 게임 룰 정리 (Game Rules Summary)

```
맵: 5×5 그리드
시작 위치: 빨강 (2,0) / 파랑 (2,4)  [row, col]
           빨강: 맨 위쪽 가운데 / 파랑: 맨 아래쪽 가운데

라운드 흐름:
  1. 경로 지정 단계 (10초 타이머)
     - 두 플레이어 동시에 경로 지정
     - 경로 포인트 = 현재 턴 수 (초기: 5, 최대: 10)
  2. 이동 단계
     - 양쪽 경로 동시 공개 + 애니메이션 이동
     - 이동 중 또는 이동 완료 지점에서 충돌 감지
  3. 충돌 판정
     - 충돌 시 도망자 HP -1
     - 도망자 HP 0 → 패배

역할 교대:
  - 1라운드: 빨강 공격, 파랑 도망
  - 2라운드: 파랑 공격, 빨강 도망
  - (이후 반복)
```

---

## 5. 데이터 모델 (Data Model)

### 게임 상태 (GameState)

```typescript
interface GameState {
  roomId: string;
  turn: number; // 현재 턴 (라운드) 수, 1부터 시작
  phase: "planning" | "moving" | "result" | "gameover";
  pathPoints: number; // min(5 + turn - 1, 10)

  players: {
    red: PlayerState;
    blue: PlayerState;
  };

  attackerColor: "red" | "blue"; // 현재 라운드 공격자
}

interface PlayerState {
  id: string;
  nickname: string;
  hp: number; // 0~3
  position: Position; // 현재 위치
  plannedPath: Position[]; // 이번 라운드 지정 경로
  pathSubmitted: boolean;
  stats: {
    wins: number;
    losses: number;
  };
}

interface Position {
  row: number; // 0~4
  col: number; // 0~4
}
```

### 소켓 이벤트 (Socket Events)

```typescript
// Client → Server
"submit_path"; // 경로 제출
"request_rematch"; // 재시합 요청
"accept_rematch"; // 재시합 수락
"chat_message"; // 채팅 메시지

// Server → Client
"game_start"; // 게임 시작
"phase_change"; // 단계 변경 (planning → moving → result)
"paths_reveal"; // 양쪽 경로 공개 (이동 시작)
"collision"; // 충돌 발생
"round_end"; // 라운드 종료
"game_over"; // 게임 종료
"rematch_request"; // 상대방 재시합 요청
"rematch_start"; // 재시합 시작
"chat_receive"; // 채팅 수신
```

---

## 6. 구현 순서 (Implementation Order)

### Phase 1: 핵심 게임 엔진 (P0 필수)

1. 프로젝트 초기화 (Vite + React + TypeScript)
2. Socket.IO 서버 (Node.js) — 방 생성, 입장
3. 5×5 그리드 렌더링
4. 경로 지정 UI (드래그 + 방향키)
5. 경로 제출 → 동시 이동 애니메이션
6. 충돌 판정 + HP 시스템
7. 공격자/도망자 역할 교대

### Phase 2: 게임 완성도 (P0)

8. 타이머 게이지 UI
9. HP 하트 UI + Bold 표시 (플레이어별)
10. 게임 종료 (WIN/LOSE) + REMATCH 시스템
11. 이펙트 (광원, 깜빡임, 충돌, 폭발)

### Phase 3: 로비 + 부가 기능 (P1)

12. 게스트 로그인 / 방 코드 매칭
13. 사운드 이펙트 + 음소거
14. 채팅 (Tab 포커스)
15. AI 대전 / 랜덤 매치메이킹
16. 상대 프로필 박스

---

## 7. 비기능 요구사항 (Non-functional)

| 항목   | 목표                            |
| ------ | ------------------------------- |
| 응답성 | 소켓 이벤트 지연 < 100ms        |
| 동기화 | 이동 애니메이션 양쪽 동시 시작  |
| 호환성 | Chrome, Firefox, Edge 최신 버전 |
| 접근성 | 키보드만으로 완전 플레이 가능   |

---

## 8. 리스크 및 고려사항

| 리스크                               | 대응                                  |
| ------------------------------------ | ------------------------------------- |
| 경로 충돌 판정 복잡성 (이동 중 교차) | 각 스텝별 위치 비교 알고리즘 설계     |
| 동시 REMATCH 처리                    | 서버에서 상태 플래그로 중복 방지      |
| 타이머 동기화                        | 서버 타이머 기준, 클라이언트는 표시만 |
| 드래그 경로 UX                       | 터치 이벤트도 함께 지원 고려          |

---

## 9. 성공 기준 (Success Criteria)

- [ ] 두 플레이어가 동시에 경로를 지정하고 이동할 수 있다
- [ ] 충돌 판정이 정확하게 이루어진다
- [ ] HP 시스템 및 역할 교대가 정상 동작한다
- [ ] 게임 종료 및 재시합이 안정적으로 동작한다
- [ ] 드래그 + 방향키로 경로 지정이 가능하다
- [ ] 타이머가 양쪽에서 동기화된다

---

_Generated by PDCA Plan Phase — PathClash Web Turn-Based Game_
